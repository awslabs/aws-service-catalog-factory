Schema: enum("factory-2019-04-01", required=False)
schema: enum("factory-2019-04-01", required=False)

Workspaces: list(include('workspace'))

---
options_terraform:
  Version: str()

options:
  Terraform: include("options_terraform", required=False)

code_s3_bucket:
  Bucket: str()
  Key: str(required=False)

code_s3_key:
  Bucket: str(required=False)
  Key: str()

code_s3: any(include('code_s3_bucket'), include('code_s3_key'))

code:
  S3: include('code_s3')

configuration_codecommit:
  RepositoryName: str()
  BranchName: str()
  Code: include('code', required=False)

configuration_github:
  Branch: str()
  Owner: str()
  Repo: str()

source: any(include("source_codecommit"), include("source_github"))

source_codecommit:
  Provider: enum("CodeCommit")
  Configuration: include('configuration_codecommit')

source_github:
  Provider: enum("Github")
  Configuration: include('configuration_github')

version:
  Name: str()
  Tags: list(include('tag'), required=False)
  Active: bool(required=False)
  Options: include('options', required=False)
  BuildSpecImage: str(required=False)
  BuildSpec: str(required=False)
  Source: include('source', required=False)
  Stages: include('stage', required=False)

version_with_source:
  Name: str()
  Tags: list(include('tag'), required=False)
  Active: bool(required=False)
  Options: include('options', required=False)
  BuildSpecImage: str(required=False)
  BuildSpec: str(required=False)
  Source: include('source')
  Stages: include('stage', required=False)

workspace: any(include("workspace_without_source"), include("workspace_with_source"))

stage: include('stage_test')

build_build_spec_image:
  BuildSpecImage: str()
  BuildSpec: str(required=False)

build_build_spec:
  BuildSpecImage: str(required=False)
  BuildSpec: str()

test: include('test_def')

test_def: any(include('build_build_spec_image'),include('build_build_spec'))


stage_test:
  Tests: map(include('test'), required=False)

workspace_without_source:
  Name: str()
  BuildSpecImage: str(required=False)
  BuildSpec: str(required=False)
  Source: include('source', required=False)
  Stages: include('stage', required=False)
  Options: include('options', required=False)
  Tags: list(include('tag'), required=False)
  Versions: list(include('version_with_source'), required=False)

workspace_with_source:
  Name: str()
  BuildSpecImage: str(required=False)
  BuildSpec: str(required=False)
  Source: include('source')
  Stages: include('stage', required=False)
  Options: include('options', required=False)
  Tags: list(include('tag'), required=False)
  Versions: list(include('version'), required=False)
